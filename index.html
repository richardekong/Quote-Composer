<!DOCTYPE>
<html>
    <head>
        <title>Quote Composer</title>
        <link href="style/style.css" rel="stylesheet"/>
        <script src="script/quote_template.js"></script>
        <script src="script/FileSaver.min.js"></script> 
        <script src="script/dom-to-image.js"></script>
        
    </head>
    <body>
        <div class="composer-section">
            <span class="title gradient">Quote Composer</span>
            <form id="composer">
                <label for="author">Author:</Label>
                <br>
                <input id="author" name="author" type="text" placeholder="Author" required/>
                <br>
                <br>
                <label for="avatar">Avatar:</label>
                <br>
                <input id="avatar_link" name="avatar" type="url" placeholder="avatar link" required/>
                <br>
                <br>
                <label for="qoute">Quote:</label>
                <br>
                <textarea id="quote" name="Quote"   placeholder="Qoute" required></textarea>
                <br>
                <br>
                <button id="compose" class="gradient" value="Compose">Compose</button>
                <br>
            </form>
        </div>
        <div id="composed-quote-section"></div>
        <script>
            
            const composer = document.getElementById("composer");
            const composeBtn = document.getElementById("compose");
            const authorInput =  document.getElementById("author");
            const quoteInput = document.getElementById("quote");
            const avatarLinkInput =  document.getElementById("avatar_link");
            const composedQuoteSection = document.getElementById("composed-quote-section");

           
            composeBtn.onclick = (evt) =>{
                
                let author = authorInput.value;
                let quote= quoteInput.value;
                let avatarURL = avatarLinkInput.value;
            
                if (!author || !quote || !avatarURL) {
                    throw "Provide all values for author, quote and avatar link";
                }

                composedQuoteSection.innerHTML = (composeQuote(author, avatarURL, quote)).innerHTML;
                downloadImage(composedQuoteSection, author);
            
            };

            composer.onsubmit = () => false;

            const downloadImage = (element, quoteAuthor) =>{
                domtoimage.toBlob(element)
                .then((blob) => saveAs(blob, `${quoteAuthor}\u0020${Date.now()}.png`))
                .catch((error)=> {
                    alert("Failed to download image.");
                });
            };

        </script>
    </body>
</html>